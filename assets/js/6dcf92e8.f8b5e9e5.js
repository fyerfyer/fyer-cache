"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[992],{1865:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>s,contentTitle:()=>h,default:()=>o,frontMatter:()=>a,metadata:()=>c,toc:()=>d});const c=JSON.parse('{"id":"getting-started/usingpattern","title":"Using Pattern","description":"\u672c\u6587\u6863\u4ecb\u7ecd FyerCache \u7684\u6838\u5fc3\u529f\u80fd\u548c\u57fa\u672c\u4f7f\u7528\u6a21\u5f0f\u3002","source":"@site/docs/getting-started/usingpattern.md","sourceDirName":"getting-started","slug":"/getting-started/usingpattern","permalink":"/fyer-cache/docs/getting-started/usingpattern","draft":false,"unlisted":false,"editUrl":"https://github.com/fyerfyer/fyer-rpc/tree/main/docs/getting-started/usingpattern.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Quick Star","permalink":"/fyer-cache/docs/getting-started/quickstart"},"next":{"title":"fyer-cache","permalink":"/fyer-cache/docs/intro"}}');var i=n(4848),t=n(8453);const a={},h="Using Pattern",s={},d=[{value:"\u6838\u5fc3\u7f13\u5b58\u63a5\u53e3",id:"\u6838\u5fc3\u7f13\u5b58\u63a5\u53e3",level:2},{value:"\u4f7f\u7528\u5185\u5b58\u7f13\u5b58",id:"\u4f7f\u7528\u5185\u5b58\u7f13\u5b58",level:2},{value:"\u521b\u5efa\u57fa\u7840\u5185\u5b58\u7f13\u5b58",id:"\u521b\u5efa\u57fa\u7840\u5185\u5b58\u7f13\u5b58",level:3},{value:"\u914d\u7f6e\u5185\u5b58\u7f13\u5b58",id:"\u914d\u7f6e\u5185\u5b58\u7f13\u5b58",level:3},{value:"\u5f02\u6b65\u6e05\u7406\u8fc7\u671f\u9879\u76ee",id:"\u5f02\u6b65\u6e05\u7406\u8fc7\u671f\u9879\u76ee",level:3},{value:"\u5185\u5b58\u9650\u5236\u548c LRU \u6dd8\u6c70",id:"\u5185\u5b58\u9650\u5236\u548c-lru-\u6dd8\u6c70",level:3},{value:"\u5206\u7247\u7f13\u5b58",id:"\u5206\u7247\u7f13\u5b58",level:2},{value:"\u57fa\u672c\u5206\u7247\u7f13\u5b58",id:"\u57fa\u672c\u5206\u7247\u7f13\u5b58",level:3},{value:"\u9ad8\u5e76\u53d1\u73af\u5883\u4f7f\u7528",id:"\u9ad8\u5e76\u53d1\u73af\u5883\u4f7f\u7528",level:3},{value:"\u57fa\u4e8e\u8282\u70b9\u7684\u5206\u7247\u7f13\u5b58",id:"\u57fa\u4e8e\u8282\u70b9\u7684\u5206\u7247\u7f13\u5b58",level:2},{value:"\u81ea\u5b9a\u4e49\u54c8\u5e0c\u51fd\u6570",id:"\u81ea\u5b9a\u4e49\u54c8\u5e0c\u51fd\u6570",level:3},{value:"\u8bbe\u7f6e\u526f\u672c\u56e0\u5b50",id:"\u8bbe\u7f6e\u526f\u672c\u56e0\u5b50",level:3},{value:"\u4e00\u81f4\u6027\u7b56\u7565",id:"\u4e00\u81f4\u6027\u7b56\u7565",level:2},{value:"Cache-Aside \u6a21\u5f0f",id:"cache-aside-\u6a21\u5f0f",level:3},{value:"Write-Through \u6a21\u5f0f",id:"write-through-\u6a21\u5f0f",level:3},{value:"\u6d88\u606f\u961f\u5217\u901a\u77e5\u6a21\u5f0f",id:"\u6d88\u606f\u961f\u5217\u901a\u77e5\u6a21\u5f0f",level:3},{value:"\u76d1\u63a7",id:"\u76d1\u63a7",level:2},{value:"\u57fa\u672c\u76d1\u63a7",id:"\u57fa\u672c\u76d1\u63a7",level:3},{value:"\u83b7\u53d6\u76d1\u63a7\u6570\u636e",id:"\u83b7\u53d6\u76d1\u63a7\u6570\u636e",level:3},{value:"\u547d\u4e2d\u7387\u7edf\u8ba1",id:"\u547d\u4e2d\u7387\u7edf\u8ba1",level:3},{value:"HTTP API\u670d\u52a1\u5668",id:"http-api\u670d\u52a1\u5668",level:2},{value:"\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879",id:"\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u8d44\u6e90\u7ba1\u7406",id:"\u8d44\u6e90\u7ba1\u7406",level:3},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:3},{value:"\u5e76\u53d1\u8003\u8651",id:"\u5e76\u53d1\u8003\u8651",level:3},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2}];function l(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"using-pattern",children:"Using Pattern"})}),"\n",(0,i.jsx)(r.p,{children:"\u672c\u6587\u6863\u4ecb\u7ecd FyerCache \u7684\u6838\u5fc3\u529f\u80fd\u548c\u57fa\u672c\u4f7f\u7528\u6a21\u5f0f\u3002"}),"\n",(0,i.jsx)(r.h2,{id:"\u6838\u5fc3\u7f13\u5b58\u63a5\u53e3",children:"\u6838\u5fc3\u7f13\u5b58\u63a5\u53e3"}),"\n",(0,i.jsx)(r.p,{children:"\u6240\u6709 FyerCache \u7f13\u5b58\u5b9e\u73b0\u90fd\u57fa\u4e8e\u76f8\u540c\u7684\u6838\u5fc3\u63a5\u53e3\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"// Cache \u57fa\u672c\u7f13\u5b58\u63a5\u53e3\r\ntype Cache interface {\r\n    Get(ctx context.Context, key string) (any, error)\r\n    Set(ctx context.Context, key string, val any, expiration time.Duration) error\r\n    Del(ctx context.Context, key string) error\r\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u8fd9\u4e2a\u7b80\u6d01\u7684\u63a5\u53e3\u4f7f\u6240\u6709\u7f13\u5b58\u5b9e\u73b0\u4fdd\u6301\u4e00\u81f4\u7684\u4f7f\u7528\u6a21\u5f0f\uff0c\u65e0\u8bba\u662f\u5185\u5b58\u7f13\u5b58\u8fd8\u662f\u5206\u5e03\u5f0f\u7f13\u5b58\u3002"}),"\n",(0,i.jsx)(r.h2,{id:"\u4f7f\u7528\u5185\u5b58\u7f13\u5b58",children:"\u4f7f\u7528\u5185\u5b58\u7f13\u5b58"}),"\n",(0,i.jsx)(r.h3,{id:"\u521b\u5efa\u57fa\u7840\u5185\u5b58\u7f13\u5b58",children:"\u521b\u5efa\u57fa\u7840\u5185\u5b58\u7f13\u5b58"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'package main\r\n\r\nimport (\r\n    "context"\r\n    "fmt"\r\n    "time"\r\n\r\n    "github.com/fyerfyer/fyer-cache/cache"\r\n)\r\n\r\nfunc main() {\r\n    // \u521b\u5efa\u4e00\u4e2a\u5185\u5b58\u7f13\u5b58\uff0c\u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\r\n    memCache := cache.NewMemoryCache()\r\n    ctx := context.Background()\r\n\r\n    // \u8bbe\u7f6e\u7f13\u5b58\u9879\uff0c5\u5206\u949f\u540e\u8fc7\u671f\r\n    err := memCache.Set(ctx, "user:1001", "John Doe", 5*time.Minute)\r\n    if err != nil {\r\n        fmt.Printf("Failed to set cache: %v\\n", err)\r\n        return\r\n    }\r\n\r\n    // \u83b7\u53d6\u7f13\u5b58\u9879\r\n    val, err := memCache.Get(ctx, "user:1001")\r\n    if err != nil {\r\n        fmt.Printf("Failed to get from cache: %v\\n", err)\r\n        return\r\n    }\r\n    fmt.Printf("User: %v\\n", val)\r\n\r\n    // \u5220\u9664\u7f13\u5b58\u9879\r\n    err = memCache.Del(ctx, "user:1001")\r\n    if err != nil {\r\n        fmt.Printf("Failed to delete from cache: %v\\n", err)\r\n        return\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(r.h3,{id:"\u914d\u7f6e\u5185\u5b58\u7f13\u5b58",children:"\u914d\u7f6e\u5185\u5b58\u7f13\u5b58"}),"\n",(0,i.jsx)(r.p,{children:"\u5185\u5b58\u7f13\u5b58\u652f\u6301\u591a\u79cd\u914d\u7f6e\u9009\u9879\uff0c\u901a\u8fc7\u9009\u9879\u6a21\u5f0f\u8bbe\u7f6e\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'// \u521b\u5efa\u5e26\u6709\u81ea\u5b9a\u4e49\u914d\u7f6e\u7684\u5185\u5b58\u7f13\u5b58\r\ncache := cache.NewMemoryCache(\r\n    // \u8bbe\u7f6e\u5206\u7247\u6570\u91cf\uff0c\u51cf\u5c11\u9501\u7ade\u4e89\r\n    cache.WithShardCount(32), \r\n    \r\n    // \u8bbe\u7f6e\u6dd8\u6c70\u56de\u8c03\u51fd\u6570\r\n    cache.WithEvictionCallback(func(key string, value any) {\r\n        fmt.Printf("Evicted: %s\\n", key)\r\n    }),\r\n    \r\n    // \u8bbe\u7f6e\u6e05\u7406\u95f4\u9694\r\n    cache.WithCleanupInterval(10*time.Minute),\r\n    \r\n    // \u542f\u7528\u5f02\u6b65\u6e05\u7406\r\n    cache.WithAsyncCleanup(true),\r\n    \r\n    // \u8bbe\u7f6e\u6e05\u7406\u5de5\u4f5c\u534f\u7a0b\u6570\u91cf\r\n    cache.CacheWithWorkerCount(runtime.NumCPU()),\r\n)\n'})}),"\n",(0,i.jsx)(r.h3,{id:"\u5f02\u6b65\u6e05\u7406\u8fc7\u671f\u9879\u76ee",children:"\u5f02\u6b65\u6e05\u7406\u8fc7\u671f\u9879\u76ee"}),"\n",(0,i.jsx)(r.p,{children:"\u5f53\u7f13\u5b58\u4e2d\u6709\u5927\u91cf\u9879\u76ee\u65f6\uff0c\u540c\u6b65\u6e05\u7406\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\u3002FyerCache \u63d0\u4f9b\u5f02\u6b65\u6e05\u7406\u529f\u80fd\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"// \u4f7f\u7528\u5f02\u6b65\u6e05\u7406\u521b\u5efa\u7f13\u5b58\r\ncache := cache.NewMemoryCache(\r\n    cache.WithAsyncCleanup(true),       // \u542f\u7528\u5f02\u6b65\u6e05\u7406\r\n    cache.CacheWithWorkerCount(4),      // 4\u4e2a\u6e05\u7406\u5de5\u4f5c\u534f\u7a0b\r\n    cache.CacheWithQueueSize(100),      // \u4efb\u52a1\u961f\u5217\u5927\u5c0f\r\n    cache.WithCleanupInterval(5*time.Minute), // \u6bcf5\u5206\u949f\u6267\u884c\u6e05\u7406\r\n)\r\n\r\n// \u4f7f\u7528\u5b8c\u540e\u8bb0\u5f97\u5173\u95ed\u8d44\u6e90\r\ndefer cache.Close()\n"})}),"\n",(0,i.jsx)(r.h3,{id:"\u5185\u5b58\u9650\u5236\u548c-lru-\u6dd8\u6c70",children:"\u5185\u5b58\u9650\u5236\u548c LRU \u6dd8\u6c70"}),"\n",(0,i.jsxs)(r.p,{children:["\u5bf9\u4e8e\u9700\u8981\u63a7\u5236\u5185\u5b58\u4f7f\u7528\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,i.jsx)(r.code,{children:"MemCacheMemory"}),"\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"// \u521b\u5efa\u4e00\u4e2a\u57fa\u7840\u5185\u5b58\u7f13\u5b58\r\nbaseCache := cache.NewMemoryCache()\r\n\r\n// \u521b\u5efa\u4e00\u4e2a\u6709\u5185\u5b58\u9650\u5236\u7684\u7f13\u5b58\u88c5\u9970\u5668\uff0c\u9650\u5236\u4e3a 100MB\r\nmemLimitedCache := cache.NewMemCacheMemory(baseCache, 100*1024*1024)\r\n\r\n// \u5f53\u5185\u5b58\u4f7f\u7528\u8d85\u8fc7\u9650\u5236\u65f6\uff0c\u4f1a\u4f7f\u7528 LRU \u7b56\u7565\u6dd8\u6c70\u6700\u4e45\u672a\u4f7f\u7528\u7684\u9879\n"})}),"\n",(0,i.jsx)(r.h2,{id:"\u5206\u7247\u7f13\u5b58",children:"\u5206\u7247\u7f13\u5b58"}),"\n",(0,i.jsx)(r.h3,{id:"\u57fa\u672c\u5206\u7247\u7f13\u5b58",children:"\u57fa\u672c\u5206\u7247\u7f13\u5b58"}),"\n",(0,i.jsx)(r.p,{children:"\u5206\u7247\u7f13\u5b58\u901a\u8fc7\u5c06\u6570\u636e\u5206\u5e03\u5728\u591a\u4e2a\u5206\u7247\u4e0a\u51cf\u5c11\u9501\u7ade\u4e89\uff0c\u63d0\u9ad8\u5e76\u53d1\u6027\u80fd\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'// \u521b\u5efa\u4e00\u4e2a32\u5206\u7247\u7684\u5185\u5b58\u7f13\u5b58\r\nshardedCache := cache.NewMemoryCache(cache.WithShardCount(32))\r\n\r\n// \u4f7f\u7528\u65b9\u5f0f\u4e0e\u666e\u901a\u7f13\u5b58\u76f8\u540c\r\nctx := context.Background()\r\nshardedCache.Set(ctx, "key1", "value1", time.Hour)\r\nvalue, err := shardedCache.Get(ctx, "key1")\n'})}),"\n",(0,i.jsx)(r.h3,{id:"\u9ad8\u5e76\u53d1\u73af\u5883\u4f7f\u7528",children:"\u9ad8\u5e76\u53d1\u73af\u5883\u4f7f\u7528"}),"\n",(0,i.jsx)(r.p,{children:"\u5206\u7247\u7f13\u5b58\u5728\u9ad8\u5e76\u53d1\u73af\u5883\u4e2d\u5c24\u5176\u6709\u6548\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'// \u9ad8\u5e76\u53d1\u8bfb\u5199\u793a\u4f8b\r\nfunc performHighConcurrentOperations(c cache.Cache) {\r\n    var wg sync.WaitGroup\r\n    ctx := context.Background()\r\n    \r\n    // 100\u4e2a\u534f\u7a0b\u5e76\u53d1\u5199\u5165\r\n    for i := 0; i < 100; i++ {\r\n        wg.Add(1)\r\n        go func(id int) {\r\n            defer wg.Done()\r\n            key := fmt.Sprintf("key:%d", id)\r\n            c.Set(ctx, key, fmt.Sprintf("value:%d", id), time.Hour)\r\n        }(i)\r\n    }\r\n    \r\n    // 100\u4e2a\u534f\u7a0b\u5e76\u53d1\u8bfb\u53d6\r\n    for i := 0; i < 100; i++ {\r\n        wg.Add(1)\r\n        go func(id int) {\r\n            defer wg.Done()\r\n            key := fmt.Sprintf("key:%d", id)\r\n            c.Get(ctx, key)\r\n        }(i)\r\n    }\r\n    \r\n    wg.Wait()\r\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"\u57fa\u4e8e\u8282\u70b9\u7684\u5206\u7247\u7f13\u5b58",children:"\u57fa\u4e8e\u8282\u70b9\u7684\u5206\u7247\u7f13\u5b58"}),"\n",(0,i.jsx)(r.p,{children:"NodeShardedCache \u5141\u8bb8\u60a8\u5728\u591a\u4e2a\u7f13\u5b58\u8282\u70b9\u4e4b\u95f4\u5206\u5e03\u6570\u636e\uff0c\u8fd9\u662f\u6784\u5efa\u5206\u5e03\u5f0f\u7f13\u5b58\u7684\u57fa\u7840\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'// \u521b\u5efa\u57fa\u4e8e\u8282\u70b9\u7684\u5206\u7247\u7f13\u5b58\r\nshardedCache := cache.NewNodeShardedCache()\r\n\r\n// \u521b\u5efa\u4e09\u4e2a\u72ec\u7acb\u7684\u5185\u5b58\u7f13\u5b58\u4f5c\u4e3a\u8282\u70b9\r\nnode1 := cache.NewMemoryCache()\r\nnode2 := cache.NewMemoryCache()\r\nnode3 := cache.NewMemoryCache()\r\n\r\n// \u5c06\u8282\u70b9\u6dfb\u52a0\u5230\u5206\u7247\u7f13\u5b58\u4e2d\uff0c\u53ef\u4ee5\u6307\u5b9a\u6743\u91cd\r\nshardedCache.AddNode("node1", node1, 1)  // \u6743\u91cd 1\r\nshardedCache.AddNode("node2", node2, 1)  // \u6743\u91cd 1 \r\nshardedCache.AddNode("node3", node3, 2)  // \u6743\u91cd 2\uff0c\u5c06\u63a5\u6536\u7ea6\u4e24\u500d\u7684\u952e\r\n\r\n// \u4f7f\u7528\u65b9\u5f0f\u4e0e\u666e\u901a\u7f13\u5b58\u76f8\u540c\uff0c\u4f46\u6570\u636e\u4f1a\u57fa\u4e8e\u952e\u81ea\u52a8\u8def\u7531\u5230\u6b63\u786e\u7684\u8282\u70b9\r\nctx := context.Background()\r\nshardedCache.Set(ctx, "user:1001", userData, time.Hour)\n'})}),"\n",(0,i.jsx)(r.h3,{id:"\u81ea\u5b9a\u4e49\u54c8\u5e0c\u51fd\u6570",children:"\u81ea\u5b9a\u4e49\u54c8\u5e0c\u51fd\u6570"}),"\n",(0,i.jsx)(r.p,{children:"\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u81f4\u6027\u54c8\u5e0c\u4f7f\u7528\u7684\u54c8\u5e0c\u51fd\u6570\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"// \u81ea\u5b9a\u4e49\u54c8\u5e0c\u51fd\u6570\r\ncustomHashFunc := func(data []byte) uint32 {\r\n    h := fnv.New32a()\r\n    h.Write(data)\r\n    return h.Sum32()\r\n}\r\n\r\n// \u521b\u5efa\u4f7f\u7528\u81ea\u5b9a\u4e49\u54c8\u5e0c\u51fd\u6570\u7684\u5206\u7247\u7f13\u5b58\r\nshardedCache := cache.NewNodeShardedCache(\r\n    cache.WithNodeCustomHashFunc(customHashFunc),\r\n)\n"})}),"\n",(0,i.jsx)(r.h3,{id:"\u8bbe\u7f6e\u526f\u672c\u56e0\u5b50",children:"\u8bbe\u7f6e\u526f\u672c\u56e0\u5b50"}),"\n",(0,i.jsx)(r.p,{children:"\u526f\u672c\u56e0\u5b50\u63a7\u5236\u6bcf\u4e2a\u6570\u636e\u9879\u5b58\u50a8\u5728\u591a\u5c11\u4e2a\u8282\u70b9\u4e0a\uff0c\u63d0\u9ad8\u53ef\u7528\u6027\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"// \u521b\u5efa\u526f\u672c\u56e0\u5b50\u4e3a2\u7684\u5206\u7247\u7f13\u5b58\uff08\u6bcf\u4e2a\u952e\u5b58\u50a8\u57282\u4e2a\u8282\u70b9\u4e0a\uff09\r\nshardedCache := cache.NewNodeShardedCache(\r\n    cache.WithNodeReplicaFactor(2),\r\n)\n"})}),"\n",(0,i.jsx)(r.h2,{id:"\u4e00\u81f4\u6027\u7b56\u7565",children:"\u4e00\u81f4\u6027\u7b56\u7565"}),"\n",(0,i.jsx)(r.p,{children:"FyerCache \u63d0\u4f9b\u591a\u79cd\u7f13\u5b58\u4e00\u81f4\u6027\u7b56\u7565\uff0c\u5904\u7406\u7f13\u5b58\u4e0e\u6570\u636e\u6e90\u7684\u534f\u8c03\u3002"}),"\n",(0,i.jsx)(r.h3,{id:"cache-aside-\u6a21\u5f0f",children:"Cache-Aside \u6a21\u5f0f"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'package main\r\n\r\nimport (\r\n    "context"\r\n    "fmt"\r\n    "time"\r\n    \r\n    "github.com/fyerfyer/fyer-cache/cache"\r\n    "github.com/fyerfyer/fyer-cache/cache/consistency"\r\n)\r\n\r\n// \u7b80\u5355\u7684\u6570\u636e\u6e90\u5b9e\u73b0\r\ntype UserDB struct {\r\n    users map[string]string\r\n}\r\n\r\nfunc (db *UserDB) Load(ctx context.Context, key string) (any, error) {\r\n    if val, exists := db.users[key]; exists {\r\n        return val, nil\r\n    }\r\n    return nil, fmt.Errorf("user not found")\r\n}\r\n\r\nfunc (db *UserDB) Store(ctx context.Context, key string, value any) error {\r\n    if str, ok := value.(string); ok {\r\n        db.users[key] = str\r\n        return nil\r\n    }\r\n    return fmt.Errorf("invalid value type")\r\n}\r\n\r\nfunc (db *UserDB) Remove(ctx context.Context, key string) error {\r\n    delete(db.users, key)\r\n    return nil\r\n}\r\n\r\nfunc main() {\r\n    // \u521d\u59cb\u5316\u7f13\u5b58\u548c\u6570\u636e\u6e90\r\n    memCache := cache.NewMemoryCache()\r\n    userDB := &UserDB{users: map[string]string{\r\n        "user:1001": "John Doe",\r\n        "user:1002": "Jane Smith",\r\n    }}\r\n    \r\n    // \u521b\u5efa Cache-Aside \u7b56\u7565\r\n    cacheStrategy := consistency.NewCacheAsideStrategy(\r\n        memCache, \r\n        userDB,\r\n        consistency.WithCacheAsideTTL(10*time.Minute),\r\n    )\r\n    \r\n    ctx := context.Background()\r\n    \r\n    // \u4f7f\u7528\u7b56\u7565\u83b7\u53d6\u6570\u636e\uff0c\u5982\u679c\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u4f1a\u4ece\u6570\u636e\u6e90\u52a0\u8f7d\r\n    value, err := cacheStrategy.Get(ctx, "user:1001")\r\n    if err != nil {\r\n        fmt.Printf("Error: %v\\n", err)\r\n        return\r\n    }\r\n    fmt.Printf("User: %v\\n", value)\r\n    \r\n    // \u5199\u5165\u6570\u636e\uff0c\u4f1a\u540c\u65f6\u66f4\u65b0\u6570\u636e\u6e90\u548c\u7f13\u5b58\r\n    err = cacheStrategy.Set(ctx, "user:1003", "Robert Brown", 10*time.Minute)\r\n    if err != nil {\r\n        fmt.Printf("Error: %v\\n", err)\r\n        return\r\n    }\r\n    \r\n    // \u5220\u9664\u6570\u636e\uff0c\u4f1a\u540c\u65f6\u4ece\u6570\u636e\u6e90\u548c\u7f13\u5b58\u4e2d\u5220\u9664\r\n    err = cacheStrategy.Del(ctx, "user:1002")\r\n    if err != nil {\r\n        fmt.Printf("Error: %v\\n", err)\r\n        return\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(r.h3,{id:"write-through-\u6a21\u5f0f",children:"Write-Through \u6a21\u5f0f"}),"\n",(0,i.jsx)(r.p,{children:"Write-Through \u6a21\u5f0f\u5148\u66f4\u65b0\u6570\u636e\u6e90\uff0c\u518d\u66f4\u65b0\u7f13\u5b58\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'// \u521b\u5efa Write-Through \u7b56\u7565\r\nwriteThrough := consistency.NewWriteThroughStrategy(\r\n    memCache,\r\n    userDB,\r\n    consistency.WithWriteThroughTTL(10*time.Minute),\r\n    consistency.WithDelayedWrite(false, 0), // \u4e0d\u4f7f\u7528\u5ef6\u8fdf\u5199\u5165\r\n)\r\n\r\n// \u4f7f\u7528\u7b56\u7565\u5199\u5165\uff0c\u4f1a\u5148\u5199\u6570\u636e\u6e90\uff0c\u518d\u5199\u7f13\u5b58\r\nerr := writeThrough.Set(ctx, "user:1004", "Alice Green", 10*time.Minute)\n'})}),"\n",(0,i.jsx)(r.h3,{id:"\u6d88\u606f\u961f\u5217\u901a\u77e5\u6a21\u5f0f",children:"\u6d88\u606f\u961f\u5217\u901a\u77e5\u6a21\u5f0f"}),"\n",(0,i.jsx)(r.p,{children:"\u57fa\u4e8e\u6d88\u606f\u961f\u5217\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u6a21\u5f0f\u9002\u7528\u4e8e\u5206\u5e03\u5f0f\u73af\u5883\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'// \u7b80\u5355\u5b9e\u73b0\u4e00\u4e2a\u6d88\u606f\u53d1\u5e03\u8005\r\ntype SimplePublisher struct {\r\n    subscribers []func([]byte)\r\n}\r\n\r\nfunc (p *SimplePublisher) Publish(ctx context.Context, topic string, msg []byte) error {\r\n    for _, sub := range p.subscribers {\r\n        sub(msg)\r\n    }\r\n    return nil\r\n}\r\n\r\nfunc (p *SimplePublisher) Subscribe(topic string, handler func(msg []byte)) error {\r\n    p.subscribers = append(p.subscribers, handler)\r\n    return nil\r\n}\r\n\r\nfunc (p *SimplePublisher) Close() error {\r\n    return nil\r\n}\r\n\r\n// \u521b\u5efa\u53d1\u5e03\u8005\r\npublisher := &SimplePublisher{}\r\n\r\n// \u521b\u5efa\u57fa\u4e8e\u6d88\u606f\u961f\u5217\u7684\u901a\u77e5\u7b56\u7565\r\nmqStrategy := consistency.NewMQNotifierStrategy(\r\n    memCache,\r\n    userDB,\r\n    publisher,\r\n    consistency.WithMQTopic("cache:invalidate"),\r\n    consistency.WithMQNotifierTTL(10*time.Minute),\r\n)\r\n\r\n// \u4f7f\u7528\u7b56\u7565\uff0c\u5199\u5165\u6216\u5220\u9664\u64cd\u4f5c\u4f1a\u901a\u8fc7\u6d88\u606f\u961f\u5217\u901a\u77e5\u5176\u4ed6\u8282\u70b9\r\nerr := mqStrategy.Set(ctx, "user:1005", "Tom Wilson", 10*time.Minute)\n'})}),"\n",(0,i.jsx)(r.h2,{id:"\u76d1\u63a7",children:"\u76d1\u63a7"}),"\n",(0,i.jsx)(r.p,{children:"FyerCache \u63d0\u4f9b\u5185\u7f6e\u7684\u76d1\u63a7\u529f\u80fd\uff0c\u5e2e\u52a9\u60a8\u8ffd\u8e2a\u7f13\u5b58\u6027\u80fd\u548c\u4f7f\u7528\u60c5\u51b5\u3002"}),"\n",(0,i.jsx)(r.h3,{id:"\u57fa\u672c\u76d1\u63a7",children:"\u57fa\u672c\u76d1\u63a7"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'package main\r\n\r\nimport (\r\n    "time"\r\n\r\n    "github.com/fyerfyer/fyer-cache/cache"\r\n    "github.com/fyerfyer/fyer-cache/cache/metrics"\r\n)\r\n\r\nfunc main() {\r\n    // \u521b\u5efa\u5185\u5b58\u7f13\u5b58\r\n    memCache := cache.NewMemoryCache()\r\n    \r\n    // \u521b\u5efa\u5e26\u76d1\u63a7\u7684\u7f13\u5b58\u5305\u88c5\u5668\r\n    monitoredCache := metrics.NewMonitoredCache(\r\n        memCache,\r\n        metrics.WithMetricsServer(":8080"),      // \u57288080\u7aef\u53e3\u66b4\u9732\u6307\u6807\r\n        metrics.WithNamespace("myapp"),          // \u6307\u6807\u547d\u540d\u7a7a\u95f4\r\n        metrics.WithSubsystem("cache"),          // \u6307\u6807\u5b50\u7cfb\u7edf\r\n        metrics.WithCollectInterval(10*time.Second), // \u6536\u96c6\u95f4\u9694\r\n    )\r\n    \r\n    // \u542f\u52a8\u76d1\u63a7\u670d\u52a1\r\n    monitoredCache.Start()\r\n    defer monitoredCache.Stop()\r\n    \r\n    // \u4f7f\u7528monitoredCache\u4ee3\u66ffmemCache\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u4f1a\u88ab\u76d1\u63a7\r\n    // monitoredCache.Get(), monitoredCache.Set(), monitoredCache.Del()\r\n}\n'})}),"\n",(0,i.jsx)(r.h3,{id:"\u83b7\u53d6\u76d1\u63a7\u6570\u636e",children:"\u83b7\u53d6\u76d1\u63a7\u6570\u636e"}),"\n",(0,i.jsx)(r.p,{children:"\u60a8\u53ef\u4ee5\u901a\u8fc7 HTTP \u83b7\u53d6 Prometheus \u683c\u5f0f\u7684\u76d1\u63a7\u6570\u636e\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"curl http://localhost:8080/metrics\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u4e3b\u8981\u6307\u6807\u5305\u62ec\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"myapp_cache_hit_count"})," - \u7f13\u5b58\u547d\u4e2d\u6b21\u6570"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"myapp_cache_miss_count"})," - \u7f13\u5b58\u672a\u547d\u4e2d\u6b21\u6570"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"myapp_cache_request_count"})," - \u6309\u64cd\u4f5c\u7c7b\u578b\u8ba1\u6570\u7684\u8bf7\u6c42\u6570\u91cf"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"myapp_cache_operation_latency_seconds"})," - \u64cd\u4f5c\u5ef6\u8fdf\u5206\u5e03"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"myapp_cache_memory_usage_bytes"})," - \u5185\u5b58\u4f7f\u7528\u91cf"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"myapp_cache_item_count"})," - \u7f13\u5b58\u9879\u6570\u91cf"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"\u547d\u4e2d\u7387\u7edf\u8ba1",children:"\u547d\u4e2d\u7387\u7edf\u8ba1"}),"\n",(0,i.jsx)(r.p,{children:"\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u7f13\u5b58\u547d\u4e2d\u7387\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'// \u83b7\u53d6\u5f53\u524d\u547d\u4e2d\u7387\r\nhitRate := monitoredCache.HitRate()\r\nfmt.Printf("Current hit rate: %.2f%%\\n", hitRate*100)\n'})}),"\n",(0,i.jsx)(r.h2,{id:"http-api\u670d\u52a1\u5668",children:"HTTP API\u670d\u52a1\u5668"}),"\n",(0,i.jsx)(r.p,{children:"FyerCache \u63d0\u4f9b HTTP API \u670d\u52a1\u5668\uff0c\u65b9\u4fbf\u901a\u8fc7 REST API \u7ba1\u7406\u7f13\u5b58\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'package main\r\n\r\nimport (\r\n    "time"\r\n    \r\n    "github.com/fyerfyer/fyer-cache/cache"\r\n    "github.com/fyerfyer/fyer-cache/cache/api"\r\n)\r\n\r\nfunc main() {\r\n    // \u521b\u5efa\u5185\u5b58\u7f13\u5b58\r\n    memCache := cache.NewMemoryCache()\r\n    \r\n    // \u521b\u5efa API \u670d\u52a1\u5668\r\n    apiServer := api.NewAPIServer(\r\n        memCache,\r\n        api.WithBindAddress(":8081"),     // \u7ed1\u5b9a\u5730\u5740\r\n        api.WithBasePath("/api/cache"),   // API\u57fa\u7840\u8def\u5f84\r\n        api.WithTimeouts(                 // \u8d85\u65f6\u8bbe\u7f6e\r\n            5*time.Second,  // \u8bfb\u8d85\u65f6\r\n            5*time.Second,  // \u5199\u8d85\u65f6\r\n            30*time.Second, // \u7a7a\u95f2\u8d85\u65f6\r\n        ),\r\n    )\r\n    \r\n    // \u542f\u52a8 API \u670d\u52a1\u5668\r\n    if err := apiServer.Start(); err != nil {\r\n        panic(err)\r\n    }\r\n    \r\n    // \u5e94\u7528\u7ee7\u7eed\u8fd0\u884c...\r\n    // defer apiServer.Stop()\r\n}\n'})}),"\n",(0,i.jsx)(r.p,{children:"API \u7aef\u70b9\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"GET /api/cache/stats"})," - \u83b7\u53d6\u7f13\u5b58\u7edf\u8ba1\u4fe1\u606f"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"POST /api/cache/invalidate?key=X"})," - \u4f7f\u6307\u5b9a\u7684\u952e\u5931\u6548"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879",children:"\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,i.jsx)(r.h3,{id:"\u8d44\u6e90\u7ba1\u7406",children:"\u8d44\u6e90\u7ba1\u7406"}),"\n",(0,i.jsx)(r.p,{children:"\u786e\u4fdd\u5728\u5e94\u7528\u7a0b\u5e8f\u9000\u51fa\u524d\uff0c\u6b63\u786e\u5173\u95ed\u6240\u6709\u7f13\u5b58\u8d44\u6e90\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"// \u5185\u5b58\u7f13\u5b58\r\nmemCache := cache.NewMemoryCache()\r\ndefer memCache.Close()\r\n\r\n// \u76d1\u63a7\u7f13\u5b58\r\nmonitoredCache := metrics.NewMonitoredCache(memCache)\r\ndefer monitoredCache.Stop()\r\n\r\n// API \u670d\u52a1\u5668\r\napiServer := api.NewAPIServer(memCache)\r\ndefer apiServer.Stop()\n"})}),"\n",(0,i.jsx)(r.h3,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,i.jsx)(r.p,{children:"\u5904\u7406\u7f13\u5b58\u64cd\u4f5c\u4e2d\u53ef\u80fd\u51fa\u73b0\u7684\u9519\u8bef\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'// \u68c0\u67e5\u7279\u5b9a\u9519\u8bef\u7c7b\u578b\r\nval, err := cache.Get(ctx, "key")\r\nif err != nil {\r\n    if errors.Is(err, ferr.ErrKeyNotFound) {\r\n        // \u5904\u7406\u7f13\u5b58\u672a\u547d\u4e2d\r\n    } else {\r\n        // \u5904\u7406\u5176\u4ed6\u9519\u8bef\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(r.h3,{id:"\u5e76\u53d1\u8003\u8651",children:"\u5e76\u53d1\u8003\u8651"}),"\n",(0,i.jsx)(r.p,{children:"FyerCache \u7684\u6240\u6709\u5b9e\u73b0\u90fd\u662f\u5e76\u53d1\u5b89\u5168\u7684\uff0c\u4f46\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e2d\uff1a"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:["\u4f7f\u7528\u8db3\u591f\u7684\u5206\u7247\u6570\u51cf\u5c11\u9501\u7ade\u4e89 (",(0,i.jsx)(r.code,{children:"WithShardCount"}),")"]}),"\n",(0,i.jsxs)(r.li,{children:["\u8003\u8651\u4f7f\u7528\u5f02\u6b65\u6e05\u7406 (",(0,i.jsx)(r.code,{children:"WithAsyncCleanup"}),") \u907f\u514d\u6e05\u7406\u8fc7\u7a0b\u963b\u585e\u7f13\u5b58\u64cd\u4f5c"]}),"\n",(0,i.jsx)(r.li,{children:"\u5bf9\u4e8e\u5206\u5e03\u5f0f\u5b9e\u73b0\uff0c\u8bbe\u7f6e\u5408\u7406\u7684\u8d85\u65f6\u548c\u91cd\u8bd5\u7b56\u7565"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,i.jsx)(r.p,{children:"\u73b0\u5728\u60a8\u5df2\u7ecf\u4e86\u89e3\u4e86 FyerCache \u7684\u57fa\u672c\u4f7f\u7528\u6a21\u5f0f\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u63a2\u7d22\uff1a"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u5206\u5e03\u5f0f\u7f13\u5b58 - \u6784\u5efa\u8de8\u8282\u70b9\u7684\u7f13\u5b58\u7cfb\u7edf"}),"\n",(0,i.jsx)(r.li,{children:"\u96c6\u7fa4\u7ba1\u7406 - \u7ba1\u7406\u7f13\u5b58\u8282\u70b9\u96c6\u7fa4"}),"\n",(0,i.jsx)(r.li,{children:"\u7f13\u5b58\u7b56\u7565 - \u6df1\u5165\u4e86\u89e3\u7f13\u5b58\u6dd8\u6c70\u7b56\u7565"}),"\n",(0,i.jsx)(r.li,{children:"API\u53c2\u8003 - \u5b8c\u6574API\u6587\u6863"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"\u65e0\u8bba\u60a8\u7684\u9700\u6c42\u662f\u7b80\u5355\u7684\u672c\u5730\u7f13\u5b58\uff0c\u8fd8\u662f\u590d\u6742\u7684\u5206\u5e03\u5f0f\u7f13\u5b58\u96c6\u7fa4\uff0cFyerCache \u90fd\u63d0\u4f9b\u4e86\u7075\u6d3b\u7684\u89e3\u51b3\u65b9\u6848\u3002"})]})}function o(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>h});var c=n(6540);const i={},t=c.createContext(i);function a(e){const r=c.useContext(t);return c.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function h(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),c.createElement(t.Provider,{value:r},e.children)}}}]);