"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[967],{700:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>s,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"api-reference/cluster-api","title":"Cluster-Management API","description":"\u57fa\u7840\u96c6\u7fa4\u8282\u70b9","source":"@site/docs/api-reference/cluster-api.md","sourceDirName":"api-reference","slug":"/api-reference/cluster-api","permalink":"/fyer-cache/docs/api-reference/cluster-api","draft":false,"unlisted":false,"editUrl":"https://github.com/fyerfyer/fyer-rpc/tree/main/docs/api-reference/cluster-api.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Cache Interface & Method","permalink":"/fyer-cache/docs/api-reference/cache-interface"},"next":{"title":"Config Options","permalink":"/fyer-cache/docs/api-reference/config-option"}}');var l=n(4848),c=n(8453);const i={},d="Cluster-Management API",s={},o=[{value:"\u57fa\u7840\u96c6\u7fa4\u8282\u70b9",id:"\u57fa\u7840\u96c6\u7fa4\u8282\u70b9",level:2},{value:"Node",id:"node",level:3},{value:"\u521b\u5efa\u8282\u70b9",id:"\u521b\u5efa\u8282\u70b9",level:4},{value:"\u4e3b\u8981\u65b9\u6cd5",id:"\u4e3b\u8981\u65b9\u6cd5",level:4},{value:"\u6210\u5458\u7ba1\u7406",id:"\u6210\u5458\u7ba1\u7406",level:2},{value:"Membership",id:"membership",level:3},{value:"\u4e3b\u8981\u65b9\u6cd5",id:"\u4e3b\u8981\u65b9\u6cd5-1",level:4},{value:"Gossip \u534f\u8bae",id:"gossip-\u534f\u8bae",level:2},{value:"Gossiper",id:"gossiper",level:3},{value:"\u4e3b\u8981\u65b9\u6cd5",id:"\u4e3b\u8981\u65b9\u6cd5-2",level:4},{value:"\u6570\u636e\u540c\u6b65",id:"\u6570\u636e\u540c\u6b65",level:2},{value:"SyncManager",id:"syncmanager",level:3},{value:"\u4e3b\u8981\u65b9\u6cd5",id:"\u4e3b\u8981\u65b9\u6cd5-3",level:4},{value:"\u96c6\u7fa4\u7f13\u5b58",id:"\u96c6\u7fa4\u7f13\u5b58",level:2},{value:"ClusterCache",id:"clustercache",level:3},{value:"\u521b\u5efa\u96c6\u7fa4\u7f13\u5b58",id:"\u521b\u5efa\u96c6\u7fa4\u7f13\u5b58",level:4},{value:"\u4e3b\u8981\u65b9\u6cd5",id:"\u4e3b\u8981\u65b9\u6cd5-4",level:4},{value:"\u5206\u7247\u96c6\u7fa4\u7f13\u5b58",id:"\u5206\u7247\u96c6\u7fa4\u7f13\u5b58",level:2},{value:"ShardedClusterCache",id:"shardedclustercache",level:3},{value:"\u521b\u5efa\u5206\u7247\u96c6\u7fa4\u7f13\u5b58",id:"\u521b\u5efa\u5206\u7247\u96c6\u7fa4\u7f13\u5b58",level:4},{value:"\u4e3b\u8981\u65b9\u6cd5",id:"\u4e3b\u8981\u65b9\u6cd5-5",level:4},{value:"\u4e3b\u4ece\u590d\u5236\u96c6\u7fa4",id:"\u4e3b\u4ece\u590d\u5236\u96c6\u7fa4",level:2},{value:"LeaderFollowerCluster",id:"leaderfollowercluster",level:3},{value:"\u521b\u5efa\u4e3b\u4ece\u96c6\u7fa4",id:"\u521b\u5efa\u4e3b\u4ece\u96c6\u7fa4",level:4},{value:"\u4e3b\u8981\u65b9\u6cd5",id:"\u4e3b\u8981\u65b9\u6cd5-6",level:4},{value:"\u4e8b\u4ef6\u7cfb\u7edf",id:"\u4e8b\u4ef6\u7cfb\u7edf",level:2},{value:"EventPublisher",id:"eventpublisher",level:3},{value:"\u4e3b\u8981\u65b9\u6cd5",id:"\u4e3b\u8981\u65b9\u6cd5-7",level:4},{value:"\u4e8b\u4ef6\u521b\u5efa\u5de5\u5177\u51fd\u6570",id:"\u4e8b\u4ef6\u521b\u5efa\u5de5\u5177\u51fd\u6570",level:3},{value:"\u4e8b\u4ef6\u4f7f\u7528\u793a\u4f8b",id:"\u4e8b\u4ef6\u4f7f\u7528\u793a\u4f8b",level:3},{value:"\u914d\u7f6e\u53c2\u8003",id:"\u914d\u7f6e\u53c2\u8003",level:2},{value:"NodeConfig",id:"nodeconfig",level:3},{value:"NodeOption",id:"nodeoption",level:3},{value:"ShardedClusterCacheOption",id:"shardedclustercacheoption",level:3},{value:"LeaderFollowerClusterOption",id:"leaderfollowerclusteroption",level:3},{value:"\u5b8c\u6574\u793a\u4f8b\uff1a\u4e3b\u4ece\u67b6\u6784\u96c6\u7fa4",id:"\u5b8c\u6574\u793a\u4f8b\u4e3b\u4ece\u67b6\u6784\u96c6\u7fa4",level:2},{value:"\u5b8c\u6574\u793a\u4f8b\uff1a\u5206\u7247\u96c6\u7fa4",id:"\u5b8c\u6574\u793a\u4f8b\u5206\u7247\u96c6\u7fa4",level:2}];function a(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.header,{children:(0,l.jsx)(r.h1,{id:"cluster-management-api",children:"Cluster-Management API"})}),"\n",(0,l.jsx)(r.h2,{id:"\u57fa\u7840\u96c6\u7fa4\u8282\u70b9",children:"\u57fa\u7840\u96c6\u7fa4\u8282\u70b9"}),"\n",(0,l.jsx)(r.h3,{id:"node",children:"Node"}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.code,{children:"Node"})," \u662f FyerCache \u96c6\u7fa4\u7684\u57fa\u7840\u6784\u5efa\u5757\uff0c\u5c01\u88c5\u4e86\u5355\u4e2a\u7f13\u5b58\u8282\u70b9\u7684\u529f\u80fd\uff0c\u5305\u62ec\u6210\u5458\u7ba1\u7406\u3001\u901a\u4fe1\u548c\u72b6\u6001\u7ba1\u7406\u3002"]}),"\n",(0,l.jsx)(r.h4,{id:"\u521b\u5efa\u8282\u70b9",children:"\u521b\u5efa\u8282\u70b9"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"func NewNode(id string, cache cache.Cache, options ...NodeOption) (*Node, error)\n"})}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u53c2\u6570"}),"\uff1a"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"id"})," - \u8282\u70b9\u552f\u4e00\u6807\u8bc6\u7b26"]}),"\n",(0,l.jsx)(r.li,{children:"cache - \u672c\u5730\u7f13\u5b58\u5b9e\u4f8b"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"options"})," - \u8282\u70b9\u914d\u7f6e\u9009\u9879"]}),"\n"]}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u521b\u5efa\u7684\u8282\u70b9\u5b9e\u4f8b\u548c\u53ef\u80fd\u7684\u9519\u8bef"}),"\n"]}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u793a\u4f8b"}),"\uff1a"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:'// \u521b\u5efa\u5185\u5b58\u7f13\u5b58\u5b9e\u4f8b\r\nlocalCache := cache.NewMemoryCache()\r\n\r\n// \u521b\u5efa\u96c6\u7fa4\u8282\u70b9\r\nnode, err := cluster.NewNode(\r\n    "node-1",\r\n    localCache,\r\n    cluster.WithBindAddr(":7946"),\r\n    cluster.WithGossipInterval(500 * time.Millisecond),\r\n    cluster.WithProbeInterval(1 * time.Second),\r\n)\n'})}),"\n",(0,l.jsx)(r.h4,{id:"\u4e3b\u8981\u65b9\u6cd5",children:"\u4e3b\u8981\u65b9\u6cd5"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"// \u542f\u52a8\u8282\u70b9\u670d\u52a1\r\nfunc (n *Node) Start() error\r\n\r\n// \u505c\u6b62\u8282\u70b9\u670d\u52a1\r\nfunc (n *Node) Stop() error\r\n\r\n// \u52a0\u5165\u96c6\u7fa4\r\nfunc (n *Node) Join(seedNodeAddr string) error\r\n\r\n// \u79bb\u5f00\u96c6\u7fa4\r\nfunc (n *Node) Leave() error\r\n\r\n// \u83b7\u53d6\u96c6\u7fa4\u6210\u5458\u5217\u8868\r\nfunc (n *Node) Members() []cache.NodeInfo\r\n\r\n// \u5224\u65ad\u5f53\u524d\u8282\u70b9\u662f\u5426\u4e3a\u534f\u8c03\u8005\r\nfunc (n *Node) IsCoordinator() bool\r\n\r\n// \u83b7\u53d6\u4e8b\u4ef6\u901a\u77e5\u901a\u9053\r\nfunc (n *Node) Events() <-chan cache.ClusterEvent\r\n\r\n// \u83b7\u53d6\u8282\u70b9\u7684\u6210\u5458\u7ba1\u7406\u5668\r\nfunc (n *Node) Membership() *Membership\n"})}),"\n",(0,l.jsx)(r.h2,{id:"\u6210\u5458\u7ba1\u7406",children:"\u6210\u5458\u7ba1\u7406"}),"\n",(0,l.jsx)(r.h3,{id:"membership",children:"Membership"}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.code,{children:"Membership"})," \u8d1f\u8d23\u7ba1\u7406\u96c6\u7fa4\u6210\u5458\u8d44\u683c\uff0c\u5904\u7406\u8282\u70b9\u52a0\u5165\u3001\u79bb\u5f00\u548c\u6545\u969c\u68c0\u6d4b\u3002"]}),"\n",(0,l.jsx)(r.h4,{id:"\u4e3b\u8981\u65b9\u6cd5-1",children:"\u4e3b\u8981\u65b9\u6cd5"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"// \u542f\u52a8\u6210\u5458\u7ba1\u7406\u5668\r\nfunc (m *Membership) Start() error\r\n\r\n// \u505c\u6b62\u6210\u5458\u7ba1\u7406\u5668\r\nfunc (m *Membership) Stop() error\r\n\r\n// \u83b7\u53d6\u6240\u6709\u6210\u5458\r\nfunc (m *Membership) Members() []cache.NodeInfo\r\n\r\n// \u6dfb\u52a0\u65b0\u6210\u5458\r\nfunc (m *Membership) AddMember(nodeID, addr string, metadata map[string]string)\r\n\r\n// \u79fb\u9664\u6210\u5458\r\nfunc (m *Membership) RemoveMember(nodeID string, graceful bool)\r\n\r\n// \u5c06\u8282\u70b9\u6807\u8bb0\u4e3a\u53ef\u7591\u72b6\u6001\r\nfunc (m *Membership) MarkSuspect(nodeID string)\r\n\r\n// \u5c06\u8282\u70b9\u6807\u8bb0\u4e3a\u5728\u7ebf\u72b6\u6001\r\nfunc (m *Membership) MarkAlive(nodeID string)\r\n\r\n// \u5c06\u8282\u70b9\u6807\u8bb0\u4e3a\u5931\u8d25\u72b6\u6001\r\nfunc (m *Membership) MarkFailed(nodeID string, reason string)\r\n\r\n// \u83b7\u53d6\u8282\u70b9\u5730\u5740\r\nfunc (m *Membership) GetNodeAddr(nodeID string) (string, error)\r\n\r\n// \u901a\u8fc7\u5730\u5740\u67e5\u627e\u8282\u70b9ID\r\nfunc (m *Membership) GetNodeByAddr(addr string) (string, error)\r\n\r\n// \u68c0\u67e5\u5f53\u524d\u8282\u70b9\u662f\u5426\u4e3a\u534f\u8c03\u8005\r\nfunc (m *Membership) IsCoordinator() bool\r\n\r\n// \u8bbe\u7f6e\u672c\u5730\u8282\u70b9\u7684\u5143\u6570\u636e\r\nfunc (m *Membership) SetLocalMetadata(metadata map[string]string)\n"})}),"\n",(0,l.jsx)(r.h2,{id:"gossip-\u534f\u8bae",children:"Gossip \u534f\u8bae"}),"\n",(0,l.jsx)(r.h3,{id:"gossiper",children:"Gossiper"}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.code,{children:"Gossiper"})," \u5b9e\u73b0 Gossip \u534f\u8bae\uff0c\u8d1f\u8d23\u96c6\u7fa4\u6210\u5458\u4fe1\u606f\u7684\u9ad8\u6548\u4f20\u64ad\u3002"]}),"\n",(0,l.jsx)(r.h4,{id:"\u4e3b\u8981\u65b9\u6cd5-2",children:"\u4e3b\u8981\u65b9\u6cd5"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"// \u542f\u52a8 Gossip \u534f\u8bae\r\nfunc (g *Gossiper) Start() error\r\n\r\n// \u505c\u6b62 Gossip \u534f\u8bae\r\nfunc (g *Gossiper) Stop() error\r\n\r\n// \u5904\u7406\u63a5\u6536\u5230\u7684 Gossip \u6d88\u606f\r\nfunc (g *Gossiper) HandleGossip(msg *cache.NodeMessage) error\n"})}),"\n",(0,l.jsx)(r.h2,{id:"\u6570\u636e\u540c\u6b65",children:"\u6570\u636e\u540c\u6b65"}),"\n",(0,l.jsx)(r.h3,{id:"syncmanager",children:"SyncManager"}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.code,{children:"SyncManager"})," \u8d1f\u8d23\u8282\u70b9\u95f4\u7684\u6570\u636e\u540c\u6b65\uff0c\u786e\u4fdd\u96c6\u7fa4\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002"]}),"\n",(0,l.jsx)(r.h4,{id:"\u4e3b\u8981\u65b9\u6cd5-3",children:"\u4e3b\u8981\u65b9\u6cd5"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"// \u542f\u52a8\u540c\u6b65\u7ba1\u7406\u5668\r\nfunc (sm *SyncManager) Start() error\r\n\r\n// \u505c\u6b62\u540c\u6b65\u7ba1\u7406\u5668\r\nfunc (sm *SyncManager) Stop() error\r\n\r\n// \u5c06\u540c\u6b65\u4efb\u52a1\u52a0\u5165\u961f\u5217\r\nfunc (sm *SyncManager) QueueSyncTask(targetNode string, keyRange KeyRange, priority int)\r\n\r\n// \u89e6\u53d1\u5bf9\u7279\u5b9a\u8282\u70b9\u7684\u540c\u6b65\r\nfunc (sm *SyncManager) TriggerSync(targetNode string, keyRange KeyRange)\r\n\r\n// \u89e6\u53d1\u5bf9\u6240\u6709\u8282\u70b9\u7684\u5b8c\u6574\u540c\u6b65\r\nfunc (sm *SyncManager) TriggerFullSync()\r\n\r\n// \u5904\u7406\u6536\u5230\u7684\u540c\u6b65\u8bf7\u6c42\r\nfunc (sm *SyncManager) HandleSyncRequest(msg *cache.NodeMessage) (*cache.NodeMessage, error)\n"})}),"\n",(0,l.jsx)(r.h2,{id:"\u96c6\u7fa4\u7f13\u5b58",children:"\u96c6\u7fa4\u7f13\u5b58"}),"\n",(0,l.jsx)(r.h3,{id:"clustercache",children:"ClusterCache"}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.code,{children:"ClusterCache"})," \u5c06\u672c\u5730\u7f13\u5b58\u4e0e\u96c6\u7fa4\u529f\u80fd\u7ed3\u5408\uff0c\u63d0\u4f9b\u5206\u5e03\u5f0f\u7f13\u5b58\u63a5\u53e3\u3002"]}),"\n",(0,l.jsx)(r.h4,{id:"\u521b\u5efa\u96c6\u7fa4\u7f13\u5b58",children:"\u521b\u5efa\u96c6\u7fa4\u7f13\u5b58"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"func NewClusterCache(localCache cache.Cache, nodeID string, bindAddr string, options ...NodeOption) (*ClusterCache, error)\n"})}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u53c2\u6570"}),"\uff1a"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"localCache"})," - \u672c\u5730\u7f13\u5b58\u5b9e\u4f8b"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"nodeID"})," - \u8282\u70b9ID"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"bindAddr"})," - \u7ed1\u5b9a\u5730\u5740"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"options"})," - \u8282\u70b9\u914d\u7f6e\u9009\u9879"]}),"\n"]}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u521b\u5efa\u7684\u96c6\u7fa4\u7f13\u5b58\u5b9e\u4f8b\u548c\u53ef\u80fd\u7684\u9519\u8bef"}),"\n"]}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u793a\u4f8b"}),"\uff1a"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:'// \u521b\u5efa\u5185\u5b58\u7f13\u5b58\r\nmemCache := cache.NewMemoryCache()\r\n\r\n// \u521b\u5efa\u96c6\u7fa4\u7f13\u5b58\r\nclusterCache, err := cluster.NewClusterCache(\r\n    memCache,\r\n    "node-1",\r\n    ":7946",\r\n    cluster.WithGossipInterval(500 * time.Millisecond),\r\n)\n'})}),"\n",(0,l.jsx)(r.h4,{id:"\u4e3b\u8981\u65b9\u6cd5-4",children:"\u4e3b\u8981\u65b9\u6cd5"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"// \u542f\u52a8\u96c6\u7fa4\u7f13\u5b58\r\nfunc (cc *ClusterCache) Start() error\r\n\r\n// \u505c\u6b62\u96c6\u7fa4\u7f13\u5b58\r\nfunc (cc *ClusterCache) Stop() error\r\n\r\n// \u52a0\u5165\u96c6\u7fa4\r\nfunc (cc *ClusterCache) Join(seedNodeAddr string) error\r\n\r\n// \u79bb\u5f00\u96c6\u7fa4\r\nfunc (cc *ClusterCache) Leave() error\r\n\r\n// \u83b7\u53d6\u96c6\u7fa4\u6210\u5458\r\nfunc (cc *ClusterCache) Members() []cache.NodeInfo\r\n\r\n// \u83b7\u53d6\u4e8b\u4ef6\u901a\u9053\r\nfunc (cc *ClusterCache) Events() <-chan cache.ClusterEvent\r\n\r\n// \u5224\u65ad\u5f53\u524d\u8282\u70b9\u662f\u5426\u4e3a\u534f\u8c03\u8005\r\nfunc (cc *ClusterCache) IsCoordinator() bool\r\n\r\n// \u8bbe\u7f6e\u672c\u5730\u8282\u70b9\u7684\u5143\u6570\u636e\r\nfunc (cc *ClusterCache) SetLocalMetadata(metadata map[string]string)\r\n\r\n// \u8bbe\u7f6e\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\r\nfunc (cc *ClusterCache) WithEventHandler(handler func(event cache.ClusterEvent))\r\n\r\n// \u83b7\u53d6\u96c6\u7fa4\u4fe1\u606f\u6458\u8981\r\nfunc (cc *ClusterCache) GetClusterInfo() map[string]interface{}\r\n\r\n// \u7f13\u5b58\u63a5\u53e3\u65b9\u6cd5\r\nfunc (cc *ClusterCache) Get(ctx context.Context, key string) (any, error)\r\nfunc (cc *ClusterCache) Set(ctx context.Context, key string, val any, expiration time.Duration) error\r\nfunc (cc *ClusterCache) Del(ctx context.Context, key string) error\n"})}),"\n",(0,l.jsx)(r.h2,{id:"\u5206\u7247\u96c6\u7fa4\u7f13\u5b58",children:"\u5206\u7247\u96c6\u7fa4\u7f13\u5b58"}),"\n",(0,l.jsx)(r.h3,{id:"shardedclustercache",children:"ShardedClusterCache"}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.code,{children:"ShardedClusterCache"})," \u6574\u5408\u4e00\u81f4\u6027\u54c8\u5e0c\u5206\u7247\u4e0e\u96c6\u7fa4\u529f\u80fd\uff0c\u652f\u6301\u6570\u636e\u5206\u7247\u548c\u81ea\u52a8\u8def\u7531\u3002"]}),"\n",(0,l.jsx)(r.h4,{id:"\u521b\u5efa\u5206\u7247\u96c6\u7fa4\u7f13\u5b58",children:"\u521b\u5efa\u5206\u7247\u96c6\u7fa4\u7f13\u5b58"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"func NewShardedClusterCache(localCache cache.Cache, nodeID string, bindAddr string, \r\n                           clusterOptions []cluster.NodeOption, \r\n                           cacheOptions []ShardedClusterCacheOption) (*ShardedClusterCache, error)\n"})}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u53c2\u6570"}),"\uff1a"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"localCache"})," - \u672c\u5730\u7f13\u5b58\u5b9e\u4f8b"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"nodeID"})," - \u8282\u70b9ID"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"bindAddr"})," - \u7ed1\u5b9a\u5730\u5740"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"clusterOptions"})," - \u96c6\u7fa4\u8282\u70b9\u914d\u7f6e\u9009\u9879"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"cacheOptions"})," - \u5206\u7247\u7f13\u5b58\u914d\u7f6e\u9009\u9879"]}),"\n"]}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u521b\u5efa\u7684\u5206\u7247\u96c6\u7fa4\u7f13\u5b58\u5b9e\u4f8b\u548c\u53ef\u80fd\u7684\u9519\u8bef"}),"\n"]}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u793a\u4f8b"}),"\uff1a"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:'// \u521b\u5efa\u5206\u7247\u96c6\u7fa4\u7f13\u5b58\r\nshardedCache, err := integration.NewShardedClusterCache(\r\n    memCache,\r\n    "node-1",\r\n    "localhost:7946",\r\n    []cluster.NodeOption{\r\n        cluster.WithGossipInterval(500 * time.Millisecond),\r\n    },\r\n    []integration.ShardedClusterCacheOption{\r\n        integration.WithVirtualNodeCount(200),\r\n        integration.WithReplicaFactor(2),\r\n    },\r\n)\n'})}),"\n",(0,l.jsx)(r.h4,{id:"\u4e3b\u8981\u65b9\u6cd5-5",children:"\u4e3b\u8981\u65b9\u6cd5"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"// \u542f\u52a8\u5206\u7247\u96c6\u7fa4\u7f13\u5b58\r\nfunc (scc *ShardedClusterCache) Start() error\r\n\r\n// \u505c\u6b62\u5206\u7247\u96c6\u7fa4\u7f13\u5b58\r\nfunc (scc *ShardedClusterCache) Stop() error\r\n\r\n// \u52a0\u5165\u96c6\u7fa4\r\nfunc (scc *ShardedClusterCache) Join(seedNodeAddr string) error\r\n\r\n// \u79bb\u5f00\u96c6\u7fa4\r\nfunc (scc *ShardedClusterCache) Leave() error\r\n\r\n// \u83b7\u53d6\u96c6\u7fa4\u6210\u5458\u5217\u8868\r\nfunc (scc *ShardedClusterCache) Members() []cache.NodeInfo\r\n\r\n// \u5224\u65ad\u5f53\u524d\u8282\u70b9\u662f\u5426\u4e3a\u534f\u8c03\u8005\r\nfunc (scc *ShardedClusterCache) IsCoordinator() bool\r\n\r\n// \u83b7\u53d6\u96c6\u7fa4\u8282\u70b9\u6570\u91cf\r\nfunc (scc *ShardedClusterCache) GetNodeCount() int\r\n\r\n// \u83b7\u53d6\u96c6\u7fa4\u4fe1\u606f\r\nfunc (scc *ShardedClusterCache) GetClusterInfo() map[string]interface{}\r\n\r\n// \u8bbe\u7f6e\u672c\u5730\u8282\u70b9\u7684\u5143\u6570\u636e\r\nfunc (scc *ShardedClusterCache) SetLocalMetadata(metadata map[string]string)\r\n\r\n// \u83b7\u53d6\u5f53\u524d\u7684\u526f\u672c\u56e0\u5b50\r\nfunc (scc *ShardedClusterCache) ReplicaFactor() int\r\n\r\n// \u83b7\u53d6\u672c\u5730\u8282\u70b9\u7684\u5730\u5740\r\nfunc (scc *ShardedClusterCache) GetAddress() string\r\n\r\n// \u83b7\u53d6\u672c\u5730\u8282\u70b9\u7684ID\r\nfunc (scc *ShardedClusterCache) GetNodeID() string\r\n\r\n// \u7f13\u5b58\u63a5\u53e3\u65b9\u6cd5\r\nfunc (scc *ShardedClusterCache) Get(ctx context.Context, key string) (any, error)\r\nfunc (scc *ShardedClusterCache) Set(ctx context.Context, key string, val any, expiration time.Duration) error\r\nfunc (scc *ShardedClusterCache) Del(ctx context.Context, key string) error\n"})}),"\n",(0,l.jsx)(r.h2,{id:"\u4e3b\u4ece\u590d\u5236\u96c6\u7fa4",children:"\u4e3b\u4ece\u590d\u5236\u96c6\u7fa4"}),"\n",(0,l.jsx)(r.h3,{id:"leaderfollowercluster",children:"LeaderFollowerCluster"}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.code,{children:"LeaderFollowerCluster"})," \u5b9e\u73b0\u4e3b\u4ece\u67b6\u6784\u7684\u7f13\u5b58\u96c6\u7fa4\uff0c\u652f\u6301\u9009\u4e3e\u3001\u590d\u5236\u548c\u6545\u969c\u8f6c\u79fb\u3002"]}),"\n",(0,l.jsx)(r.h4,{id:"\u521b\u5efa\u4e3b\u4ece\u96c6\u7fa4",children:"\u521b\u5efa\u4e3b\u4ece\u96c6\u7fa4"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"func NewLeaderFollowerCluster(nodeID string, address string, localCache cache.Cache, \r\n                             clusterOptions []cluster.NodeOption,\r\n                             lfOptions []LeaderFollowerClusterOption) (*LeaderFollowerCluster, error)\n"})}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u53c2\u6570"}),"\uff1a"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"nodeID"})," - \u8282\u70b9ID"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"address"})," - \u8282\u70b9\u5730\u5740"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"localCache"})," - \u672c\u5730\u7f13\u5b58\u5b9e\u4f8b"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"clusterOptions"})," - \u96c6\u7fa4\u8282\u70b9\u914d\u7f6e\u9009\u9879"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"lfOptions"})," - \u4e3b\u4ece\u96c6\u7fa4\u914d\u7f6e\u9009\u9879"]}),"\n"]}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u521b\u5efa\u7684\u4e3b\u4ece\u96c6\u7fa4\u5b9e\u4f8b\u548c\u53ef\u80fd\u7684\u9519\u8bef"}),"\n"]}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u793a\u4f8b"}),"\uff1a"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:'// \u521b\u5efa\u4e3b\u4ece\u96c6\u7fa4\u8282\u70b9\r\nnode, err := integration.NewLeaderFollowerCluster(\r\n    "node-1",\r\n    "localhost:7946",\r\n    localCache,\r\n    []cluster.NodeOption{\r\n        cluster.WithGossipInterval(500 * time.Millisecond),\r\n    },\r\n    []integration.LeaderFollowerClusterOption{\r\n        integration.WithSyncerAddress("localhost:8080"),\r\n        integration.WithInitialRole(replication.RoleLeader),\r\n    },\r\n)\n'})}),"\n",(0,l.jsx)(r.h4,{id:"\u4e3b\u8981\u65b9\u6cd5-6",children:"\u4e3b\u8981\u65b9\u6cd5"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"// \u542f\u52a8\u4e3b\u4ece\u96c6\u7fa4\r\nfunc (lfc *LeaderFollowerCluster) Start() error\r\n\r\n// \u505c\u6b62\u4e3b\u4ece\u96c6\u7fa4\r\nfunc (lfc *LeaderFollowerCluster) Stop() error\r\n\r\n// \u52a0\u5165\u96c6\u7fa4\r\nfunc (lfc *LeaderFollowerCluster) Join(seedNodeAddr string) error\r\n\r\n// \u79bb\u5f00\u96c6\u7fa4\r\nfunc (lfc *LeaderFollowerCluster) Leave() error\r\n\r\n// \u68c0\u67e5\u5f53\u524d\u8282\u70b9\u662f\u5426\u4e3a\u9886\u5bfc\u8005\r\nfunc (lfc *LeaderFollowerCluster) IsLeader() bool\r\n\r\n// \u83b7\u53d6\u5f53\u524d\u9886\u5bfc\u8005ID\r\nfunc (lfc *LeaderFollowerCluster) GetLeader() string\r\n\r\n// \u63d0\u5347\u4e3a\u9886\u5bfc\u8005\r\nfunc (lfc *LeaderFollowerCluster) PromoteToLeader() error\r\n\r\n// \u964d\u7ea7\u4e3a\u8ddf\u968f\u8005\r\nfunc (lfc *LeaderFollowerCluster) DemoteToFollower() error\r\n\r\n// \u6dfb\u52a0\u4ece\u8282\u70b9\uff08\u4ec5Leader\u53ef\u8c03\u7528\uff09\r\nfunc (lfc *LeaderFollowerCluster) AddFollower(nodeID string, address string) error\r\n\r\n// \u79fb\u9664\u4ece\u8282\u70b9\uff08\u4ec5Leader\u53ef\u8c03\u7528\uff09\r\nfunc (lfc *LeaderFollowerCluster) RemoveFollower(nodeID string) error\r\n\r\n// \u4ece\u9886\u5bfc\u8005\u540c\u6b65\u6570\u636e\uff08\u4ec5Follower\u53ef\u8c03\u7528\uff09\r\nfunc (lfc *LeaderFollowerCluster) SyncFromLeader(ctx context.Context) error\r\n\r\n// \u83b7\u53d6\u96c6\u7fa4\u4fe1\u606f\r\nfunc (lfc *LeaderFollowerCluster) GetClusterInfo() map[string]interface{}\r\n\r\n// \u7acb\u5373\u89e6\u53d1\u590d\u5236\r\nfunc (lfc *LeaderFollowerCluster) ReplicateNow() error\r\n\r\n// \u7f13\u5b58\u63a5\u53e3\u65b9\u6cd5\r\nfunc (lfc *LeaderFollowerCluster) Get(ctx context.Context, key string) (any, error)\r\nfunc (lfc *LeaderFollowerCluster) Set(ctx context.Context, key string, val any, expiration time.Duration) error\r\nfunc (lfc *LeaderFollowerCluster) Del(ctx context.Context, key string) error\n"})}),"\n",(0,l.jsx)(r.h2,{id:"\u4e8b\u4ef6\u7cfb\u7edf",children:"\u4e8b\u4ef6\u7cfb\u7edf"}),"\n",(0,l.jsx)(r.h3,{id:"eventpublisher",children:"EventPublisher"}),"\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.code,{children:"EventPublisher"})," \u63d0\u4f9b\u4e8b\u4ef6\u53d1\u5e03\u548c\u8ba2\u9605\u529f\u80fd\uff0c\u7528\u4e8e\u96c6\u7fa4\u5185\u90e8\u901a\u4fe1\u548c\u72b6\u6001\u53d8\u66f4\u901a\u77e5\u3002"]}),"\n",(0,l.jsx)(r.h4,{id:"\u4e3b\u8981\u65b9\u6cd5-7",children:"\u4e3b\u8981\u65b9\u6cd5"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"// \u521b\u5efa\u4e8b\u4ef6\u53d1\u5e03\u5668\r\nfunc NewEventPublisher(bufferSize int) *EventPublisher\r\n\r\n// \u8ba2\u9605\u4e8b\u4ef6\r\nfunc (p *EventPublisher) Subscribe() <-chan cache.ClusterEvent\r\n\r\n// \u53d1\u5e03\u4e8b\u4ef6\r\nfunc (p *EventPublisher) Publish(event cache.ClusterEvent)\r\n\r\n// \u5173\u95ed\u4e8b\u4ef6\u53d1\u5e03\u5668\r\nfunc (p *EventPublisher) Close()\r\n\r\n// \u8fd4\u56de\u4e3b\u4e8b\u4ef6\u901a\u9053\r\nfunc (p *EventPublisher) Events() <-chan cache.ClusterEvent\n"})}),"\n",(0,l.jsx)(r.h3,{id:"\u4e8b\u4ef6\u521b\u5efa\u5de5\u5177\u51fd\u6570",children:"\u4e8b\u4ef6\u521b\u5efa\u5de5\u5177\u51fd\u6570"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"// \u521b\u5efa\u8282\u70b9\u52a0\u5165\u4e8b\u4ef6\r\nfunc NewNodeJoinEvent(nodeID string, addr string) cache.ClusterEvent\r\n\r\n// \u521b\u5efa\u8282\u70b9\u79bb\u5f00\u4e8b\u4ef6\r\nfunc NewNodeLeaveEvent(nodeID string, graceful bool) cache.ClusterEvent\r\n\r\n// \u521b\u5efa\u8282\u70b9\u6545\u969c\u4e8b\u4ef6\r\nfunc NewNodeFailedEvent(nodeID string, reason string) cache.ClusterEvent\r\n\r\n// \u521b\u5efa\u8282\u70b9\u6062\u590d\u4e8b\u4ef6\r\nfunc NewNodeRecoveredEvent(nodeID string) cache.ClusterEvent\r\n\r\n// \u521b\u5efa\u540c\u6b65\u5b8c\u6210\u4e8b\u4ef6\r\nfunc NewSyncCompletedEvent(nodeID string, keyCount int) cache.ClusterEvent\n"})}),"\n",(0,l.jsx)(r.h3,{id:"\u4e8b\u4ef6\u4f7f\u7528\u793a\u4f8b",children:"\u4e8b\u4ef6\u4f7f\u7528\u793a\u4f8b"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:'// \u8ba2\u9605\u96c6\u7fa4\u4e8b\u4ef6\r\neventChannel := node.Events()\r\ngo func() {\r\n    for event := range eventChannel {\r\n        switch event.Type {\r\n        case cache.EventNodeJoin:\r\n            fmt.Printf("Node joined: %s\\n", event.NodeID)\r\n        case cache.EventNodeLeave:\r\n            fmt.Printf("Node left: %s\\n", event.NodeID)\r\n        case cache.EventNodeFailed:\r\n            fmt.Printf("Node failed: %s, reason: %v\\n", event.NodeID, event.Details)\r\n        case cache.EventNodeRecovered:\r\n            fmt.Printf("Node recovered: %s\\n", event.NodeID)\r\n        case cache.EventSyncCompleted:\r\n            fmt.Printf("Sync completed with node: %s\\n", event.NodeID)\r\n        }\r\n    }\r\n}()\n'})}),"\n",(0,l.jsx)(r.h2,{id:"\u914d\u7f6e\u53c2\u8003",children:"\u914d\u7f6e\u53c2\u8003"}),"\n",(0,l.jsx)(r.h3,{id:"nodeconfig",children:"NodeConfig"}),"\n",(0,l.jsx)(r.p,{children:"\u57fa\u7840\u96c6\u7fa4\u8282\u70b9\u914d\u7f6e\u9009\u9879\uff1a"}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:"\u9009\u9879\u540d\u79f0"}),(0,l.jsx)(r.th,{children:"\u63cf\u8ff0"}),(0,l.jsx)(r.th,{children:"\u9ed8\u8ba4\u503c"})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"ID"})}),(0,l.jsx)(r.td,{children:"\u8282\u70b9\u552f\u4e00\u6807\u8bc6\u7b26"}),(0,l.jsx)(r.td,{children:"-"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"BindAddr"})}),(0,l.jsx)(r.td,{children:"\u8282\u70b9\u7ed1\u5b9a\u5730\u5740"}),(0,l.jsx)(r.td,{children:'":7946"'})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"GossipInterval"})}),(0,l.jsx)(r.td,{children:"Gossip \u901a\u4fe1\u95f4\u9694"}),(0,l.jsx)(r.td,{children:"1\u79d2"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"SyncInterval"})}),(0,l.jsx)(r.td,{children:"\u6570\u636e\u540c\u6b65\u95f4\u9694"}),(0,l.jsx)(r.td,{children:"30\u79d2"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"ProbeInterval"})}),(0,l.jsx)(r.td,{children:"\u8282\u70b9\u5065\u5eb7\u68c0\u67e5\u95f4\u9694"}),(0,l.jsx)(r.td,{children:"1\u79d2"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"ProbeTimeout"})}),(0,l.jsx)(r.td,{children:"\u5065\u5eb7\u68c0\u67e5\u8d85\u65f6\u65f6\u95f4"}),(0,l.jsx)(r.td,{children:"500\u6beb\u79d2"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"SuspicionMult"})}),(0,l.jsx)(r.td,{children:"\u53ef\u7591\u72b6\u6001\u4e58\u6570"}),(0,l.jsx)(r.td,{children:"3"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"SyncConcurrency"})}),(0,l.jsx)(r.td,{children:"\u6570\u636e\u540c\u6b65\u5e76\u53d1\u6570"}),(0,l.jsx)(r.td,{children:"2"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"VirtualNodes"})}),(0,l.jsx)(r.td,{children:"\u865a\u62df\u8282\u70b9\u6570\u91cf"}),(0,l.jsx)(r.td,{children:"100"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"MaxRetries"})}),(0,l.jsx)(r.td,{children:"\u6700\u5927\u91cd\u8bd5\u6b21\u6570"}),(0,l.jsx)(r.td,{children:"3"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"RetryInterval"})}),(0,l.jsx)(r.td,{children:"\u91cd\u8bd5\u95f4\u9694"}),(0,l.jsx)(r.td,{children:"200\u6beb\u79d2"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"EventBufferSize"})}),(0,l.jsx)(r.td,{children:"\u4e8b\u4ef6\u901a\u9053\u7f13\u51b2\u533a\u5927\u5c0f"}),(0,l.jsx)(r.td,{children:"100"})]})]})]}),"\n",(0,l.jsx)(r.h3,{id:"nodeoption",children:"NodeOption"}),"\n",(0,l.jsx)(r.p,{children:"\u4f7f\u7528\u51fd\u6570\u5f0f\u9009\u9879\u6a21\u5f0f\u914d\u7f6e\u8282\u70b9\uff1a"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:'// \u8bbe\u7f6e\u8282\u70b9ID\r\ncluster.WithNodeID("node-1")\r\n\r\n// \u8bbe\u7f6e\u7ed1\u5b9a\u5730\u5740\r\ncluster.WithBindAddr(":7946")\r\n\r\n// \u8bbe\u7f6eGossip\u901a\u4fe1\u95f4\u9694\r\ncluster.WithGossipInterval(500 * time.Millisecond)\r\n\r\n// \u8bbe\u7f6e\u6570\u636e\u540c\u6b65\u95f4\u9694\r\ncluster.WithSyncInterval(10 * time.Second)\r\n\r\n// \u8bbe\u7f6e\u5065\u5eb7\u68c0\u67e5\u95f4\u9694\r\ncluster.WithProbeInterval(1 * time.Second)\r\n\r\n// \u8bbe\u7f6e\u5065\u5eb7\u68c0\u67e5\u8d85\u65f6\r\ncluster.WithProbeTimeout(500 * time.Millisecond)\r\n\r\n// \u8bbe\u7f6e\u53ef\u7591\u72b6\u6001\u4e58\u6570\r\ncluster.WithSuspicionMult(3)\r\n\r\n// \u8bbe\u7f6e\u6570\u636e\u540c\u6b65\u5e76\u53d1\u6570\r\ncluster.WithSyncConcurrency(4)\r\n\r\n// \u8bbe\u7f6e\u865a\u62df\u8282\u70b9\u6570\u91cf\r\ncluster.WithVirtualNodes(200)\r\n\r\n// \u8bbe\u7f6e\u6700\u5927\u91cd\u8bd5\u6b21\u6570\r\ncluster.WithMaxRetries(5)\r\n\r\n// \u8bbe\u7f6e\u91cd\u8bd5\u95f4\u9694\r\ncluster.WithRetryInterval(100 * time.Millisecond)\r\n\r\n// \u8bbe\u7f6e\u4e8b\u4ef6\u7f13\u51b2\u533a\u5927\u5c0f\r\ncluster.WithEventBufferSize(200)\n'})}),"\n",(0,l.jsx)(r.h3,{id:"shardedclustercacheoption",children:"ShardedClusterCacheOption"}),"\n",(0,l.jsx)(r.p,{children:"\u5206\u7247\u96c6\u7fa4\u7f13\u5b58\u7684\u914d\u7f6e\u9009\u9879\uff1a"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:"// \u8bbe\u7f6e\u4e00\u81f4\u6027\u54c8\u5e0c\u73af\u7684\u865a\u62df\u8282\u70b9\u6570\u91cf\r\nintegration.WithVirtualNodeCount(200)\r\n\r\n// \u8bbe\u7f6e\u6570\u636e\u590d\u5236\u7684\u526f\u672c\u56e0\u5b50\r\nintegration.WithReplicaFactor(2)\n"})}),"\n",(0,l.jsx)(r.h3,{id:"leaderfollowerclusteroption",children:"LeaderFollowerClusterOption"}),"\n",(0,l.jsx)(r.p,{children:"\u4e3b\u4ece\u96c6\u7fa4\u7684\u914d\u7f6e\u9009\u9879\uff1a"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:'// \u8bbe\u7f6e\u540c\u6b65\u5668\u5730\u5740\r\nintegration.WithSyncerAddress("localhost:8080")\r\n\r\n// \u8bbe\u7f6e\u521d\u59cb\u89d2\u8272\r\nintegration.WithInitialRole(replication.RoleLeader)\r\n\r\n// \u8bbe\u7f6e\u9009\u4e3e\u8d85\u65f6\r\nintegration.WithElectionTimeout(2 * time.Second)\r\n\r\n// \u8bbe\u7f6e\u5fc3\u8df3\u95f4\u9694\r\nintegration.WithHeartbeatInterval(500 * time.Millisecond)\n'})}),"\n",(0,l.jsx)(r.h2,{id:"\u5b8c\u6574\u793a\u4f8b\u4e3b\u4ece\u67b6\u6784\u96c6\u7fa4",children:"\u5b8c\u6574\u793a\u4f8b\uff1a\u4e3b\u4ece\u67b6\u6784\u96c6\u7fa4"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:'package main\r\n\r\nimport (\r\n\t"context"\r\n\t"fmt"\r\n\t"log"\r\n\t"time"\r\n\r\n\t"github.com/fyerfyer/fyer-cache/cache"\r\n\t"github.com/fyerfyer/fyer-cache/cache/cluster"\r\n\t"github.com/fyerfyer/fyer-cache/cache/cluster/integration"\r\n\t"github.com/fyerfyer/fyer-cache/cache/replication"\r\n)\r\n\r\nfunc main() {\r\n\t// \u521b\u5efa\u4e09\u4e2a\u8282\u70b9\u7684\u4e3b\u4ece\u96c6\u7fa4\r\n\tnode1, err := createLeaderFollowerCluster("node1", ":7946", ":8080", replication.RoleLeader)\r\n\tif err != nil {\r\n\t\tlog.Fatalf("Failed to create node1: %v", err)\r\n\t}\r\n\t\r\n\tnode2, err := createLeaderFollowerCluster("node2", ":7947", ":8081", replication.RoleFollower)\r\n\tif err != nil {\r\n\t\tlog.Fatalf("Failed to create node2: %v", err)\r\n\t}\r\n\t\r\n\tnode3, err := createLeaderFollowerCluster("node3", ":7948", ":8082", replication.RoleFollower)\r\n\tif err != nil {\r\n\t\tlog.Fatalf("Failed to create node3: %v", err)\r\n\t}\r\n\t\r\n\t// \u542f\u52a8\u6240\u6709\u8282\u70b9\r\n\tif err := node1.Start(); err != nil {\r\n\t\tlog.Fatalf("Failed to start node1: %v", err)\r\n\t}\r\n\tif err := node2.Start(); err != nil {\r\n\t\tlog.Fatalf("Failed to start node2: %v", err)\r\n\t}\r\n\tif err := node3.Start(); err != nil {\r\n\t\tlog.Fatalf("Failed to start node3: %v", err)\r\n\t}\r\n\t\r\n\t// \u786e\u4fdd\u4f18\u96c5\u9000\u51fa\r\n\tdefer func() {\r\n\t\tnode1.Stop()\r\n\t\tnode2.Stop()\r\n\t\tnode3.Stop()\r\n\t}()\r\n\t\r\n\t// \u5f62\u6210\u96c6\u7fa4\r\n\tnode1.Join("localhost:7946")  // \u7b2c\u4e00\u4e2a\u8282\u70b9\u81ea\u5f15\u5bfc\r\n\ttime.Sleep(500 * time.Millisecond)\r\n\t\r\n\tnode2.Join("localhost:7946")  // \u5176\u4ed6\u8282\u70b9\u52a0\u5165\u7b2c\u4e00\u4e2a\u8282\u70b9\r\n\ttime.Sleep(500 * time.Millisecond)\r\n\t\r\n\tnode3.Join("localhost:7946")\r\n\t\r\n\t// \u7b49\u5f85\u96c6\u7fa4\u7a33\u5b9a\r\n\ttime.Sleep(2 * time.Second)\r\n\t\r\n\t// \u4e3a\u4ece\u8282\u70b9\u8bbe\u7f6e\u9886\u5bfc\u8005\r\n\tnode2.SetLeader("node1", "localhost:8080")\r\n\tnode3.SetLeader("node1", "localhost:8080")\r\n\t\r\n\t// \u5199\u5165\u6570\u636e\u5230\u9886\u5bfc\u8005\r\n\tctx := context.Background()\r\n\terr = node1.Set(ctx, "key1", "value1", 10*time.Minute)\r\n\tif err != nil {\r\n\t\tlog.Printf("Error writing to leader: %v", err)\r\n\t} else {\r\n\t\tfmt.Println("Data written to leader node")\r\n\t}\r\n\t\r\n\t// \u7b49\u5f85\u590d\u5236\u5b8c\u6210\r\n\ttime.Sleep(1 * time.Second)\r\n\t\r\n\t// \u4ece\u8ddf\u968f\u8005\u8282\u70b9\u8bfb\u53d6\u6570\u636e\r\n\tvalue, err := node2.Get(ctx, "key1")\r\n\tif err != nil {\r\n\t\tlog.Printf("Error reading from node2: %v", err)\r\n\t} else {\r\n\t\tfmt.Printf("Value from node2: %v\\n", value)\r\n\t}\r\n\t\r\n\tvalue, err = node3.Get(ctx, "key1")\r\n\tif err != nil {\r\n\t\tlog.Printf("Error reading from node3: %v", err)\r\n\t} else {\r\n\t\tfmt.Printf("Value from node3: %v\\n", value)\r\n\t}\r\n}\r\n\r\n// \u521b\u5efa\u4e3b\u4ece\u96c6\u7fa4\u8282\u70b9\r\nfunc createLeaderFollowerCluster(nodeID, clusterAddr, syncerAddr string, role replication.ReplicationRole) (*integration.LeaderFollowerCluster, error) {\r\n\tlocalCache := cache.NewMemoryCache()\r\n\t\r\n\treturn integration.NewLeaderFollowerCluster(\r\n\t\tnodeID, \r\n\t\tclusterAddr, \r\n\t\tlocalCache,\r\n\t\t[]cluster.NodeOption{\r\n\t\t\tcluster.WithNodeID(nodeID),\r\n\t\t\tcluster.WithGossipInterval(500 * time.Millisecond),\r\n\t\t\tcluster.WithProbeInterval(1 * time.Second),\r\n\t\t},\r\n\t\t[]integration.LeaderFollowerClusterOption{\r\n\t\t\tintegration.WithSyncerAddress(syncerAddr),\r\n\t\t\tintegration.WithInitialRole(role),\r\n\t\t\tintegration.WithHeartbeatInterval(500 * time.Millisecond),\r\n\t\t},\r\n\t)\r\n}\n'})}),"\n",(0,l.jsx)(r.h2,{id:"\u5b8c\u6574\u793a\u4f8b\u5206\u7247\u96c6\u7fa4",children:"\u5b8c\u6574\u793a\u4f8b\uff1a\u5206\u7247\u96c6\u7fa4"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-go",children:'package main\r\n\r\nimport (\r\n    "context"\r\n    "fmt"\r\n    "log"\r\n    "time"\r\n\r\n    "github.com/fyerfyer/fyer-cache/cache"\r\n    "github.com/fyerfyer/fyer-cache/cache/cluster"\r\n    "github.com/fyerfyer/fyer-cache/cache/cluster/integration"\r\n)\r\n\r\nfunc main() {\r\n    // \u521b\u5efa\u4e09\u4e2a\u8282\u70b9\u7684\u5206\u7247\u96c6\u7fa4\r\n    node1, err := createShardedClusterCache("node1", ":7946")\r\n    if err != nil {\r\n        log.Fatalf("Failed to create node1: %v", err)\r\n    }\r\n    \r\n    node2, err := createShardedClusterCache("node2", ":7947")\r\n    if err != nil {\r\n        log.Fatalf("Failed to create node2: %v", err)\r\n    }\r\n    \r\n    node3, err := createShardedClusterCache("node3", ":7948")\r\n    if err != nil {\r\n        log.Fatalf("Failed to create node3: %v", err)\r\n    }\r\n    \r\n    // \u542f\u52a8\u6240\u6709\u8282\u70b9\r\n    if err := node1.Start(); err != nil {\r\n        log.Fatalf("Failed to start node1: %v", err)\r\n    }\r\n    if err := node2.Start(); err != nil {\r\n        log.Fatalf("Failed to start node2: %v", err)\r\n    }\r\n    if err := node3.Start(); err != nil {\r\n        log.Fatalf("Failed to start node3: %v", err)\r\n    }\r\n    \r\n    // \u786e\u4fdd\u4f18\u96c5\u9000\u51fa\r\n    defer func() {\r\n        node1.Stop()\r\n        node2.Stop()\r\n        node3.Stop()\r\n    }()\r\n    \r\n    // \u5f62\u6210\u96c6\u7fa4\r\n    node1.Join("localhost:7946")  // \u7b2c\u4e00\u4e2a\u8282\u70b9\u81ea\u5f15\u5bfc\r\n    time.Sleep(500 * time.Millisecond)\r\n    \r\n    node2.Join("localhost:7946")  // \u5176\u4ed6\u8282\u70b9\u52a0\u5165\u7b2c\u4e00\u4e2a\u8282\u70b9\r\n    time.Sleep(500 * time.Millisecond)\r\n    \r\n    node3.Join("localhost:7946")\r\n    \r\n    // \u7b49\u5f85\u96c6\u7fa4\u7a33\u5b9a\r\n    time.Sleep(2 * time.Second)\r\n    \r\n    // \u5b58\u50a8\u4e00\u4e9b\u6570\u636e\r\n    ctx := context.Background()\r\n    for i := 1; i <= 10; i++ {\r\n        key := fmt.Sprintf("key%d", i)\r\n        value := fmt.Sprintf("value%d", i)\r\n        \r\n        // \u968f\u673a\u9009\u62e9\u4e00\u4e2a\u8282\u70b9\u8fdb\u884c\u5199\u5165\r\n        // \u5728\u5b9e\u9645\u7684\u5206\u7247\u96c6\u7fa4\u4e2d\uff0c\u6570\u636e\u4f1a\u6839\u636e\u4e00\u81f4\u6027\u54c8\u5e0c\u81ea\u52a8\u8def\u7531\u5230\u6b63\u786e\u7684\u8282\u70b9\r\n        var node *integration.ShardedClusterCache\r\n        switch i % 3 {\r\n        case 0:\r\n            node = node1\r\n        case 1:\r\n            node = node2\r\n        case 2:\r\n            node = node3\r\n        }\r\n        \r\n        err := node.Set(ctx, key, value, time.Hour)\r\n        if err != nil {\r\n            log.Printf("Failed to set %s: %v", key, err)\r\n        } else {\r\n            fmt.Printf("Set %s to %s\\n", key, value)\r\n        }\r\n    }\r\n    \r\n    // \u4ece\u4e0d\u540c\u8282\u70b9\u8bfb\u53d6\u6570\u636e\r\n    time.Sleep(500 * time.Millisecond)\r\n    \r\n    for i := 1; i <= 10; i++ {\r\n        key := fmt.Sprintf("key%d", i)\r\n        \r\n        // \u4ece\u968f\u673a\u8282\u70b9\u8bfb\u53d6\u6570\u636e\r\n        var node *integration.ShardedClusterCache\r\n        switch i % 3 {\r\n        case 0:\r\n            node = node3  // \u6545\u610f\u4f7f\u7528\u4e0e\u5199\u5165\u4e0d\u540c\u7684\u8282\u70b9\r\n        case 1:\r\n            node = node1\r\n        case 2:\r\n            node = node2\r\n        }\r\n        \r\n        value, err := node.Get(ctx, key)\r\n        if err != nil {\r\n            log.Printf("Failed to get %s: %v", key, err)\r\n        } else {\r\n            fmt.Printf("Got %s = %v\\n", key, value)\r\n        }\r\n    }\r\n}\r\n\r\n// \u521b\u5efa\u5206\u7247\u96c6\u7fa4\u8282\u70b9\r\nfunc createShardedClusterCache(nodeID, addr string) (*integration.ShardedClusterCache, error) {\r\n    localCache := cache.NewMemoryCache()\r\n    \r\n    return integration.NewShardedClusterCache(\r\n        localCache,\r\n        nodeID,\r\n        addr,\r\n        []cluster.NodeOption{\r\n            cluster.WithNodeID(nodeID),\r\n            cluster.WithGossipInterval(500 * time.Millisecond),\r\n            cluster.WithProbeInterval(1 * time.Second),\r\n        },\r\n        []integration.ShardedClusterCacheOption{\r\n            integration.WithVirtualNodeCount(100),\r\n            integration.WithReplicaFactor(2),\r\n        },\r\n    )\r\n}\n'})})]})}function h(e={}){const{wrapper:r}={...(0,c.R)(),...e.components};return r?(0,l.jsx)(r,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>d});var t=n(6540);const l={},c=t.createContext(l);function i(e){const r=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),t.createElement(c.Provider,{value:r},e.children)}}}]);